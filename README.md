# MeetingNotes Automation

This project fetches Microsoft Teams transcripts for "EDA Library" meetings, summarizes them with OpenAI, and posts the summary as a Trello card.

## Setup

1. Create a `.env` with:
   - `TENANT_ID`
   - `CLIENT_ID`
   - `CLIENT_SECRET`
   - `OPENAI_API_KEY`
   - `TRELLO_KEY`
   - `TRELLO_TOKEN`
   - `TRELLO_LIST_ID` (either a Trello List ID or Board ID; board ID will be resolved to a list automatically)
   - `GRAPH_TARGET_USER` (UPN or user ID of the calendar owner)
   - `MEETING_SUBJECT` (optional, default `EDA Library`)
   - `TIME_WINDOW_HOURS` (optional, default `48`)
   - `SUMMARY_SYSTEM_PROMPT` (optional) — custom instructions for meeting summary

2. Install dependencies:
   - `pip install -r requirements.txt`

3. Run once (Graph automation):
   - `python run_once.py`

### Verify after admin consent
- Run a full setup verification (Graph app permissions, OpenAI, Trello):
  - `python verify_setup.py`
  - It checks env vars, Graph events/online meetings/transcripts access, OpenAI connectivity, and Trello list resolution.

### Delegated login (/me) without admin consent

If admin consent is not available yet, use delegated device-code login to access your own meetings and transcripts (tenant must allow user consent for `Calendars.Read`, `OnlineMeetings.Read`, `OnlineMeetingTranscript.Read`).

1) List recent "EDA Library" meetings:

```
python run_once.py --use-delegated --list-meetings
```

2) Select a meeting and transcript by index and run end-to-end. If Trello fails, the summary will be written to Markdown:

```
python run_once.py --use-delegated --meeting-index 0 --transcript-index 0 --output-md EDA_Library_Meeting_Notes.md
```

4. Run with local transcript (no admin consent needed):
   - Prepare a transcript file exported from Teams. Supported formats: `.txt` and `.docx`.
   - `python run_once.py --transcript-file path/to/transcript.docx`
   - This bypasses Graph: the script reads the transcript (DOCX is parsed into text), summarizes it with OpenAI, then posts a Trello card.

### Web UI (Drag & Drop DOCX)

If you prefer a simple front-end, a Flask-based web UI is included:

1. Ensure dependencies are installed:
   - `pip install -r requirements.txt`
2. Start the server:
   - `python webapp.py`
3. Open `http://127.0.0.1:8000/` in your browser.
4. Drag & drop a `.docx` transcript and click `Process`.

The app will:
- Extract transcript text from the DOCX
- Generate the summary using your `SUMMARY_SYSTEM_PROMPT`
- Create a Trello card where:
  - Card title uses the summary H1 heading if present
  - Card description includes content before `Actions & Follow-Up`
  - `Actions & Follow-Up` and subsequent sections are converted into Trello checklists

### Deploy to GitHub Pages (static frontend)

You can host the drag-and-drop UI on GitHub Pages and point it to a public backend:

1. Ensure `web/config.js` sets `API_BASE_URL` to your public backend (Flask/FastAPI, etc.). Example:
   ```js
   // web/config.js
   window.CONFIG = { API_BASE_URL: 'https://your-backend.example.com' };
   ```
   - For local development, leave it empty so it calls `http://127.0.0.1:8000/process` via same origin.

2. Push the repo to GitHub with default branch `main`.

3. Enable Pages using GitHub Actions:
   - The workflow `.github/workflows/deploy-pages.yml` uploads the `web/` directory and deploys it.
   - After the first successful run, Pages will serve your site at `https://<user>.github.io/<repo>/`.

Notes:
- GitHub Pages hosts static content only; the `/process` endpoint must be served by your backend.
- If you deploy the backend elsewhere, ensure CORS allows the Pages origin.


### Manual Summary via ChatGPT (Meeting Markdown GPT)

If you want to use ChatGPT’s "Meeting Markdown Assistant" to produce the notes and skip the OpenAI API call in code:

- Open `https://chatgpt.com/g/g-AR0f5lHiO-meeting-markdown-assistant` and paste your transcript.
- Copy the Markdown result into a local file, e.g. `summary.md`.
- Post it to Trello (or save locally if Trello errors) with:

```
python run_once.py --summary-file summary.md
```

- This uses your Markdown as-is and bypasses model inference in the script.

### Customize Summary Instructions

You can tailor how the summary is generated by setting `SUMMARY_SYSTEM_PROMPT` in `.env`.

Example:

```
SUMMARY_SYSTEM_PROMPT="You are Meeting Markdown Assistant. Produce concise, well-structured Markdown including: 1) Overview; 2) Key decisions; 3) Action items (owner + due date if present); 4) Risks/Blockers; 5) Follow-ups. Keep it clear and scannable."
```

Notes:
- If `SUMMARY_SYSTEM_PROMPT` is not set, the default prompt above is used.
- The prompt is passed to the Chat Completions API (`gpt-4o-mini`) as the system message.

## Notes

- Requires Microsoft Graph application permissions: `Calendars.Read.All`, `OnlineMeetings.Read.All`, `OnlineMeetingTranscript.Read.All` with admin consent.
- Teams policies must allow transcription and it must be enabled for the meeting.
- The Trello list ID can be obtained via `GET /1/boards/{boardId}/lists`.
 - To avoid admin consent temporarily, use either delegated login (`--use-delegated`) or the `--transcript-file` flow with manual transcript export.

### Selection logic
- Delegated mode: `--list-meetings` prints recent meetings with subject containing "EDA Library"; use `--meeting-index` and `--transcript-index` (0 = latest) to select.
- Application mode: selects the most recent matching meeting and its latest transcript automatically.

### App-mode testing (after admin consent + Teams Application Access Policy)

- List recent online meetings for `GRAPH_TARGET_USER` using application permissions:

```
python run_once.py --app-list-meetings
```

- Debug: show Graph user info (confirm identity resolution):

```
python run_once.py --app-user-info
```

- Debug: list recent events (calendar access check):

```
python run_once.py --app-list-events
```

- Debug: resolve an online meeting by joinUrl extracted from recent events:

```
python run_once.py --app-resolve-joinurl
```

- List transcripts for a specific meeting and verify content length (0 = latest):

```
python run_once.py --app-list-transcripts --app-meeting-index 0 --app-transcript-index 0
```

- If listing fails with `HTTP 404/403`, ensure the Application Access Policy was granted to the organizer UPN and allow time (15–60 minutes) for propagation.